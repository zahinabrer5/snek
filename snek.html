<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snek</title>
    <style>
        canvas {
            position: absolute;
        }

        #score-disp {
            font-size: 24px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="score-disp">Score: <span id="score">1</span></div>
    <canvas id="info" width="1200" height="600" style="z-index: 1;"></canvas>
    <canvas id="game-screen" width="1200" height="600" style="z-index: 0;"></canvas>
    <script>
        const gameScreen = document.getElementById("game-screen");
        const info = document.getElementById("info");
        const ctx = gameScreen.getContext('2d');
        const infoCtx = info.getContext('2d');
        const w = gameScreen.width;
        const h = gameScreen.height;
        const cellW = 25;

        window.addEventListener("keydown", this.keypress, false);

        let x = 0;
        let y = 0;
        let velX = cellW;
        let velY = 0;
        let foodX;
        let foodY;
        let realX;
        let realY;
        let snake = [];
        let lastCode = 39;
        respawnFood();

        // main game interval
        let run = setInterval(() => {
            // fill background
            ctx.fillStyle = "#000000";
            ctx.fillRect(0, 0, w, h);

            // "real" coordinates used to draw snake
            realX = mod(x, w);
            realY = mod(y, h);

            // check if snake's head has bumped into body (game over)
            if (inSnake([realX, realY])) {
                infoCtx.fillStyle = "#FFFFFF";
                infoCtx.font = "bold 48px monospace";
                infoCtx.textAlign = "center";
                infoCtx.textBaseline = "middle";
                infoCtx.fillText("GAME OVER", w/2, h/2);
                infoCtx.fillStyle = "#FFFF00";
                infoCtx.font = "bold 24px monospace";
                infoCtx.fillText(`Final Score: ${snake.length}`, w/2, h/2+48);
                clearInterval(run);
            }

            // draw food
            ctx.fillStyle = "#FF0000";
            ctx.fillRect(foodX, foodY, cellW, cellW);

            // update and draw snake body
            let oldSnake = [...snake];
            ctx.fillStyle = "#00FF00";
            for (let i = 1; i < snake.length; i++) {
                snake[i] = oldSnake[i-1];
                ctx.fillRect(snake[i][0], snake[i][1], cellW, cellW);
            }
            // update and draw snake head
            snake[0] = [realX, realY];
            ctx.fillStyle = "#0000FF";
            ctx.fillRect(realX, realY, cellW, cellW);

            // check if snake has eaten food
            if (realX == foodX && realY == foodY) {
                respawnFood();
                snake.push([realX, realY]);
                score.innerHTML = snake.length;
            }

            x += velX;
            y += velY;
        }, 100);

        // modulus instead of remainder
        function mod(n, m) {
            return ((n % m) + m) % m;
        }

        function keypress(e) {
            let code = e.keyCode;
            switch (code) {
                case 37: // left arrow key
                    if (lastCode != 39) { // make it so you can't go "backwards"
                        velX = -25;
                        velY = 0;
                        lastCode = code;
                    }
                    break;
                case 38: // up arrow key
                    if (lastCode != 40) {
                        velX = 0;
                        velY = -25;
                        lastCode = code;
                    }
                    break;
                case 39: // right arrow key
                    if (lastCode != 37) {
                        velX = 25;
                        velY = 0;
                        lastCode = code;
                    }
                    break;
                case 40: // down arrow key
                    if (lastCode != 38) {
                        velX = 0;
                        velY = 25;
                        lastCode = code;
                    }
                    break;
                default:
                    break;
            }
        }

        function respawnFood() {
            foodX = Math.floor(w/cellW * Math.random()) * cellW;
            foodY = Math.floor(h/cellW * Math.random()) * cellW;
            while (inSnake([foodX, foodY])) {
                foodX = Math.floor(w/cellW * Math.random()) * cellW;
                foodY = Math.floor(h/cellW * Math.random()) * cellW;
            }
        }

        function inSnake(cell) {
            return JSON.stringify(snake).includes(JSON.stringify(cell));
        }
    </script>
</body>
</html>
